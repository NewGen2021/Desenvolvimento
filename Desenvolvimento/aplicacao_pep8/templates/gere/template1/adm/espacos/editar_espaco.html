{% extends 'gere/template1/base_admin.html' %}
{% load static %}
{% load i18n %}
{% load mathfilters %}
{% load hosts %}
{% load crispy_forms_tags %}

{% block title %}{% translate "Edição de espaço" %}{% endblock %}

{% block css %}

<style>
    #img_tipo {
    height: auto; 
    width: auto; 
    max-width: 600px; 
    max-height: 600px;
}
small{
        display: none;
    }
    input:hover + small {
        display: block;
    }
    .form-control:hover + small {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<section id="tabs" class="project-tab">
    <div class="container">
        <div class="row">
            <h1 style="text-align: center;">{% translate "Alterar espaço" %}</h1>
        </div>
        <div class="row">
            <div class="col-md-12">
                {% if nao_existe %}
                <div class="alert alert-danger alert-dismissible fade show">
                    <strong>{% translate "ERRO!" %}</strong> {% translate "Não foi possível encontrar esse tipo de espaço, volte à tela de listar espaços e selecione ou crie um válido!" %}
                </div>
                <a role="button" class="btn btn-outline-primary" href="{% host_url 'listar_espacos' host 'custom_host' domain %}?espaco=1?page=1">{% translate "← Voltar" %}</a>
                {% else %}
                
                {% if imagem %}
                <img div="imagem_layout_cima">
                {% endif %}
                <form method="POST" class="form-group" name="formFuncionario" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group">
                          {{ form.id_tipo_espaco|as_crispy_field }}
                          <small class="form-text text-muted">
                            {% translate "Selecione o tipo deste espaço. " %}{% translate "(para editar tipos de espaço, vá para categoria)" %} 
                          </small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.status_espaco|as_crispy_field }}
                            <small class="form-text text-muted">
                                {% translate "A escolha do estado é importante para definir se este espaço está apto para reserva." %}
                                {% translate "Um espaço desativado não aparece para o usuário na hora de reservar." %}
                            </small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.preco|as_crispy_field }}
                            <small class="form-text text-muted">
                                {% translate "Defina um preço específico apenas a este espaço. " %}
                                {% translate "OBS: por padrão o preço selecionado é o do próprio tipo espaço. " %}
                            </small>
                          </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.vagas|as_crispy_field }}
                            <small class="form-text text-muted">
                                {% translate "Defina a capacidade máxima de pessoas para este espaço." %}
                                
                            </small>
                            <small class="form-text text-muted">
                                <strong id="is_compartilhado_info_negrito"></strong>
                            </small>
                          </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.imagem|as_crispy_field }}
                            <small class="form-text text-muted">
                                {% translate "Selecione a imagem a ser mostrada para o cliente quando ele for selecionar um tipo de espaço para escolher." %}
                            </small>
                        </div>
                        <hr>
                        <div>
                            <h3 style="text-align: center;">{% translate "Imagem atual" %}</h3>
                            <div style="text-align: center;">
                                <div id="image_field"></div> <br>
                            </div>
                        </div>
                        <hr>
                    </div>
                    <!-- <div class="form-row">
                        <p style="margin-left: 2.5%;"><strong>{% translate "OBS: O valor padrão é do tipo de espaço" %}</strong></p>
                    </div> -->
                    
                    <div class="d-flex flex-row">
                        <a role="button" class="btn btn-outline-primary" href="{% host_url 'listar_espacos' host 'custom_host' domain %}?espaco=1?page=1">{% translate "← Voltar" %}</a>
                        <button type="submit" id="form-checkout__submit" class="btn {{ button_color  }}" style="margin-left: 2%;">{% translate "Salvar" %}</button>
                    </div>
    
                {% if messages %}
                <div class="alert alert-warning">
                    {% for m in messages %}
                    <p {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ m }}</p>
                    {% endfor %}
                </div>
                {% endif %}
               
                  
                </form>
                {% endif %}
                
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block js %}
<!-- Mask JS Files -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>
<script>
    // Reajusta itens para dentro da div form gerada pelo django
    $( document ).ready(function() {
        var smalls = document.getElementsByTagName('small');
        const array_smalls = Array.from(smalls);
        for (let item of array_smalls) {
            form_div = item.parentNode.children[0].children[1]
            form_div.insertAdjacentElement('beforeend', item)
        }
    });

    // Atualiza o placeholder de preço
    let preco_field = document.getElementById('id_preco') // form > image field
    preco_field.setAttribute('placeholder', "{{ preco }}")
    preco_field.setAttribute('value', parseFloat("{{ preco }}"))

    // Coloca a imagem para visualização
    let image_field = document.getElementById('image_field') // form > image field
    let load_image = document.createElement('img')
    
    load_image.setAttribute('src', "/media/{{imagem}}")
    if ("{{imagem}}"!="")
    load_image.setAttribute('alt', "Image Atual")
    else
    load_image.setAttribute('alt', "Não definida")
    load_image.setAttribute('id', "img_tipo")
    image_field.parentNode.insertBefore(load_image, image_field.nextSibling)

document.getElementById('id_imagem').onchange = function() {
    document.getElementById('img_tipo') = input.value;
};
 </script>
{% endblock %}