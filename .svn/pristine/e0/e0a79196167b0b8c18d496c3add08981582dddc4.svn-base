{% load hosts %}
{% load static %}
{% load i18n %}


<link href="{% static 'css/style2.css' %}" rel="stylesheet">

<link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.css"/>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"></script>

{% block content %}

<div class="table-responsive" style="margin: 20px;">
    <h3>{% translate 'Reservas do dia' %}</h3>
    <table class="table table-striped" id="tabela_listar">
        <thead>
            <tr>
                <th>{% translate 'Cliente' %}</th>
                <th>{% translate 'Data' %}</th>
                <th>{% translate 'Hora' %}</th>
                <th>{% translate 'Espaço' %}</th>
                <th>{% translate 'Opções' %}</th>
            </tr>
        </thead>

        <tbody>
            {% for campo in object_list %}
            <tr id="campos">
                <td>{{ campo.id_cliente.nome }}</td>
                <td>{{ campo.data_reserva }}</td>
                <td>{{ campo.hora_entrada }}</td>
                <td>{{ campo.id_espaco }}</td>
                <td>
                    <button type="button" class="btn btn-success btn-sm" id="btn_valido{{campo.id_reserva}}">{% translate 'Validar Entrada' %}</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btn_finaliza{{campo.id_reserva}}"  onclick="Finaliza()">{% translate 'Finalizar Reserva' %}</button>
                </td>
                <script>
                    
                    
                    function Finaliza() {
                      if (hora = ! null) {
                        fetch(`{{ domain }}api/finaliza_reserva/{{ campo.id_reserva }}?format=json`)
                          .then(function (content) {
                            return content.json()
                          
                          })
                          .then(function (data) {
                            var hora = data['hora_saida_real']
                            var btn_valido = document.getElementById("btn_valido{{campo.id_reserva}}");
                            var campos = document.getElementById("campos");
                            var btn_finaliza = document.getElementById("btn_finaliza{{campo.id_reserva}}");

                            alert("A reserva foi finalizada!");
                            btn_finaliza.innerHTML = "Finalizado";

                            if (btn_finaliza.value = "Finalizado") {
                              btn_valido.disabled = true;
                            }
                          })
                      }
                    }
                    document.getElementById("btn_finaliza{{campo.id_reserva}}").addEventListener("click", Finaliza, false);

                  </script>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">{% translate 'Nenhum campo registrado' %}</td>
            </tr>

            {% endfor %}
       </tbody>
    </table>
</div>




{% endblock content %}


